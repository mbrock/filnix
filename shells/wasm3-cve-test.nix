{
  base,
  ports,
}:

let
  wasm3-cve-payloads = (import ../wasm3-cves.nix { pkgs = base; }).cve-tests;
in

{
  wasm3-cve-test = base.mkShell {
    name = "wasm3-cve-test";

    buildInputs = [ ports.wasm3 ];

    shellHook = ''
      cd ${wasm3-cve-payloads}

      # Multi-line prompt to handle long store paths
      export PS1='\n\[\033[1;34m\]wasm3-cve-test\[\033[0m\] \w\n\$ '

      echo "Fil-C wasm3:"
      echo "  $(which wasm3)"
      echo "Test directory:"
      echo "  $PWD"
      echo
      echo "Test files:"
      ls -1 *.wasm | sed 's/^/  /'
      echo
      echo "Try running:"
      echo "  wasm3 cve-2022-39974.wasm"
      echo "  wasm3 cve-2022-34529.wasm"
      echo
      echo "See README.txt for details"
      echo
    '';
  };
}
